/*===-- test/test_vectors/sha256.c ---------------------*- PUBLIC -*- C -*-===*/
/**
*** @file
*** @brief Test Vectors
***
*** Test vectors for the SHA-256 hash function.
**/
/*===----------------------------------------------------------------------===*/

#include "testenv.h"

/*===----------------------------------------------------------------------===*/

struct TEST_VECTOR
{
    const char *in;
    size_t in_len;
    const char *out;
    size_t out_len;
};

static const struct TEST_VECTOR tests[] =
{
{
    "", 0,
    "\xe3\xb0\xc4\x42\x98\xfc\x1c\x14\x9a\xfb\xf4\xc8\x99\x6f\xb9\x24"
    "\x27\xae\x41\xe4\x64\x9b\x93\x4c\xa4\x95\x99\x1b\x78\x52\xb8\x55", 32
},
{
    "A", 1,
    "\x55\x9a\xea\xd0\x82\x64\xd5\x79\x5d\x39\x09\x71\x8c\xdd\x05\xab"
    "\xd4\x95\x72\xe8\x4f\xe5\x55\x90\xee\xf3\x1a\x88\xa0\x8f\xdf\xfd", 32
},
{
    "hello", 5,
    "\x2c\xf2\x4d\xba\x5f\xb0\xa3\x0e\x26\xe8\x3b\x2a\xc5\xb9\xe2\x9e"
    "\x1b\x16\x1e\x5c\x1f\xa7\x42\x5e\x73\x04\x33\x62\x93\x8b\x98\x24", 32
},
{
    "\x6d\x65\x73\x73\x61\x67\x65\x20\x64\x69\x67\x65\x73\x74", 14,
    "\xf7\x84\x6f\x55\xcf\x23\xe1\x4e\xeb\xea\xb5\xb4\xe1\x55\x0c\xad"
    "\x5b\x50\x9e\x33\x48\xfb\xc4\xef\xa3\xa1\x41\x3d\x39\x3c\xb6\x50", 32
},
{
    "abcdbcdecdefdefgefghfghighijhijkijkljklmklmnlmnomnopnopq", 56,
    "\x24\x8d\x6a\x61\xd2\x06\x38\xb8\xe5\xc0\x26\x93\x0c\x3e\x60\x39"
    "\xa3\x3c\xe4\x59\x64\xff\x21\x67\xf6\xec\xed\xd4\x19\xdb\x06\xc1", 32
},
{
    "\x46\x6f\x72\x20\x74\x68\x69\x73\x20\x73\x61\x6d\x70\x6c\x65\x2c"
    "\x20\x74\x68\x69\x73\x20\x36\x33\x2d\x62\x79\x74\x65\x20\x73\x74"
    "\x72\x69\x6e\x67\x20\x77\x69\x6c\x6c\x20\x62\x65\x20\x75\x73\x65"
    "\x64\x20\x61\x73\x20\x69\x6e\x70\x75\x74\x20\x64\x61\x74\x61", 63,
    "\xf0\x8a\x78\xcb\xba\xee\x08\x2b\x05\x2a\xe0\x70\x8f\x32\xfa\x1e"
    "\x50\xc5\xc4\x21\xaa\x77\x2b\xa5\xdb\xb4\x06\xa2\xea\x6b\xe3\x42", 32
},
{
    "\x54\x68\x69\x73\x20\x69\x73\x20\x65\x78\x61\x63\x74\x6c\x79\x20"
    "\x36\x34\x20\x62\x79\x74\x65\x73\x20\x6c\x6f\x6e\x67\x2c\x20\x6e"
    "\x6f\x74\x20\x63\x6f\x75\x6e\x74\x69\x6e\x67\x20\x74\x68\x65\x20"
    "\x74\x65\x72\x6d\x69\x6e\x61\x74\x69\x6e\x67\x20\x62\x79\x74\x65", 64,
    "\xab\x64\xef\xf7\xe8\x8e\x2e\x46\x16\x5e\x29\xf2\xbc\xe4\x18\x26"
    "\xbd\x4c\x7b\x35\x52\xf6\xb3\x82\xa9\xe7\xd3\xaf\x47\xc2\x45\xf8", 32
}
};

#define MAX_OUT_LEN 32

/*===----------------------------------------------------------------------===*/

static int check(const struct TEST_VECTOR *test)
{
    unsigned char out[MAX_OUT_LEN];
    struct HASH_STATE state;

    ASSERT_SUCCESS(hash_init(&state, HASH_SHA256, 0));

    hash_update(&state, test->in, test->in_len);

    hash_final(&state, out);

    ASSERT_BUF_EQ(out, test->out, test->out_len);

    return 1;
}

int test_vectors_sha256(void);
int test_vectors_sha256(void)
{
    size_t t;

    if (!prim_avail(HASH_SHA256))
        return 1;

    for (t = 0; t < ARRAY_SIZE(tests); ++t)
        if (!check(tests + t)) return 0;

    return 1;
}
