/*===-- test/test_vectors/rc4.c ------------------------*- PUBLIC -*- C -*-===*/
/**
*** @file
*** @brief Test Vectors
***
*** Test vectors for the RC4 stream cipher.
**/
/*===----------------------------------------------------------------------===*/

#include "testenv.h"

/*===----------------------------------------------------------------------===*/

struct TEST_VECTOR
{
    const char *key;
    size_t key_len;
    const char *in;
    size_t in_len;
    const char *out;
    size_t out_len;
    int use_params;
    struct RC4_PARAMS params;
};

static const struct TEST_VECTOR tests[] =
{
{
    "\x01\x02\x03\x04\x05", 5,
    "\x01\x23\x45\x67\x89\xab\xcd\xef", 8,
    "\xcd\x7b\x6a\xec\x20\x59\xa8\x0d", 8
},
{
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 16,
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 16,
    "\xc3\x4b\x11\x6d\xa0\x18\xda\x7e\x4e\x07\x96\x53\x42\xbe\xcd\x64", 16
},
{
    "\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f", 16,
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 16,
    "\x12\x84\xaa\x5c\xc4\xc6\x41\x9d\xf0\x3d\xae\xb9\xdd\xc6\xb4\x38", 16
},
{
    "\x81\x94\xfe\x03\xff\x94\xe3\x81\xd0\xcc\x91\xb0\xaa\x9d\xe8\xf0", 16,
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 16,
    "\xf4\xf6\x95\x08\x15\x32\xea\xd3\x40\x1f\xc5\x5a\x80\x99\xe0\x1d", 16
},
{
    "\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55", 16,
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 16,
    "\xd1\x30\x52\xac\x16\x78\x92\x32\x9a\x32\x14\xf7\xc3\xaa\x7f\x09", 16
},
{
    "\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 16,
    "\x68\x65\x6c\x6c\x6f\x20\x64\x65\x61\x72\x20\x77\x6f\x72\x6c\x64", 16,
    "\xab\x2e\x7d\x01\xcf\x38\xbe\x1b\x2f\x75\xb6\x24\x2d\xcc\xa1\x00", 16
},
{
    "\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f", 16,
    "\x68\x65\x6c\x6c\x6f\x20\x64\x65\x61\x72\x20\x77\x6f\x72\x6c\x64", 16,
    "\x7a\xe1\xc6\x30\xab\xe6\x25\xf8\x91\x4f\x8e\xce\xb2\xb4\xd8\x5c", 16
},
{
    "\x81\x94\xfe\x03\xff\x94\xe3\x81\xd0\xcc\x91\xb0\xaa\x9d\xe8\xf0", 16,
    "\x68\x65\x6c\x6c\x6f\x20\x64\x65\x61\x72\x20\x77\x6f\x72\x6c\x64", 16,
    "\x9c\x93\xf9\x64\x7a\x12\x8e\xb6\x21\x6d\xe5\x2d\xef\xeb\x8c\x79", 16
},
{
    "\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55\xff\x55", 16,
    "\x68\x65\x6c\x6c\x6f\x20\x64\x65\x61\x72\x20\x77\x6f\x72\x6c\x64", 16,
    "\xb9\x55\x3e\xc0\x79\x58\xf6\x57\xfb\x40\x34\x80\xac\xd8\x13\x6d", 16
}
};

#define MAX_OUT_LEN 16

/*===----------------------------------------------------------------------===*/

static int check(struct TEST_VECTOR test)
{
    unsigned char out[MAX_OUT_LEN];
    struct STREAM_STATE state;

    ASSERT_SUCCESS(stream_init(&state, test.key, test.key_len,
                               STREAM_RC4, test.use_params
                                         ? &test.params
                                         : 0));

    memcpy(out, test.in, test.in_len);

    stream_update(&state, out, test.in_len);

    stream_final(&state);

    ASSERT_BUF_EQ(out, test.out, test.out_len);

    return 1;
}

int test_vectors_rc4(void);
int test_vectors_rc4(void)
{
    size_t t;

    if (!prim_avail(STREAM_RC4))
        return 1;

    for (t = 0; t < ARRAY_SIZE(tests); ++t)
        if (!check(tests[t])) return 0;

    return 1;
}
